<?xml version="1.0"?>

<!-- MAVLink v1.0 Message IDs from free IDs in range 180 to 229 -->
<!-- MAVLink v1.0 Command IDs from free IDs in range 12000 to 12999 -->

<mavlink>

    <include>ardupilotmega.xml</include>

    <dialect>8</dialect>

    <enums>
      <enum name="SENDER_ID">
        <description>Hello World message sender type</description>
        <entry value="0" name="SENDER_ID_GCS">
          <description>GCS is the sender</description>
        </entry>
        <entry value="1" name="SENDER_ID_RPI">
          <description>RPI is the sender</description>
        </entry>
      </enum>
      <enum name="RESCUE_STATE">
        <description>The state of the rescue code that whether it is active or not.</description>
        <entry value="0" name="RESCUE_DISABLED">
          <description>Rescue code is disabled.</description>
        </entry>
        <entry value="1" name="RESCUE_ENABLED">
          <description>Rescue code is enabled.</description>
        </entry>
      </enum>
      <enum name="THROTTLE_PROFILE_TYPE">
        <description>The throttle profile type used in the camera based guidance.</description>
        <entry value="0" name="CONSTANT">
          <description>This profile uses a constant throttle for the camera based guidance.</description>
        </entry>
        <entry value="1" name="CUSTOM_SIGMOID">
          <description>A custom profile, using sigmoid function in its heart, used for the camera based guidance. For details, go through source code of the funnywing.</description>
        </entry>
      </enum>
      <enum name="TRACK_STATE">
        <description>The state of the track. At the moment used just for locked and unlocked states.</description>
        <entry value="0" name="TRACK_STATE_UNLOCKED">
          <description>The track is unlocked.</description>
        </entry>
        <entry value="1" name="TRACK_STATE_LOCKED">
          <description>The track is locked on.</description>
        </entry>
      </enum>


      <enum name="FUNNYWING_CUSTOM_CMD">
        <description>IDs of the custom commands for funnywing system.</description>
        <entry value="0" name="SET_SIMPLE_TRACKER_SETTINGS">
          <description>Sets the settings like virtual offset and virtual center for the simple tracker algorithm.</description>
        </entry>
        <entry value="1" name="SET_SIMPLE_TRACKER_ACTIVATION">
          <description>Active and deactive the simple tracker algorithm on the RPI side.</description>
        </entry>
        <entry value="2" name="SET_TEST_SCENARIO_ACTIVATION">
          <description>Active and deactive the test scenario code on the RPI side.</description>
        </entry>
        <entry value="3" name="SET_CAMERA_PRESET_INDEX">
          <description>Changes the camera settings(usually, zoom and focus) to the values specified in the preset index of the camera preset table. In the funnywing project this index considered to be an integer value with [0-100] range.</description>
        </entry>
        <entry value="4" name="LOCK_ON_TRACK">
          <description>Used for sending the command to lock on a track with specified track id or to unlock from the track that the sensor block is currently locked on it.</description>
        </entry>
        <entry value="5" name="SET_TRACKER_CONFIGS">
          <description>Used for changing parameters and configurations of the tracker at run-time from GCS user interface.</description>
        </entry>
      </enum>

      <!-- <enum name="MAV_CMD">
        <description>Commands to be executed by the MAV. They can be executed on user request, or as part of a mission script. If the action is used in a mission, the parameter mapping to the waypoint/mission message is as follows: Param 1, Param 2, Param 3, Param 4, X: Param 5, Y:Param 6, Z:Param 7. This command list is similar what ARINC 424 is for commercial aircraft: A data format how to interpret waypoint/mission data. NaN and INT32_MAX may be used in float/integer params (respectively) to indicate optional/default values (e.g. to use the component's current yaw or latitude rather than a specific value). See https://mavlink.io/en/guide/xml_schema.html#MAV_CMD for information about the structure of the MAV_CMD entries</description>
        <entry value="12000" name="RESCUE_SET_STATE" hasLocation="false" isDestination="false">
          <description>Sets the states of the rescue code, dis/enabled.</description>
          <param index="1" label="rescue_state" enum="RESCUE_STATE" default="RESCUE_DISABLED">The state must be set in the RPI side.</param>
          <param index="2">Empty</param>
          <param index="3">Empty</param>
          <param index="4">Empty</param>
          <param index="5">Empty</param>
          <param index="6">Empty</param>
          <param index="7">Empty</param>
        </entry>
      </enum> -->
    </enums>

    <messages>
      <message id="187" name="HELLO_WORLD">
        <description>Hello World message</description>
        <field type="uint8_t" name="sender_id" enum="SENDER_ID">sender id</field>
        <field type="char[10]" name="sender_name">sender name</field>
        <field type="uint32_t" name="sequence">the sequence of the message</field>
      </message>
      <message id="188" name="COMMAND_RESPONSE">
        <description>Message for sending command results back from the RPI, Inspired by COMMAND_ACK</description>
        <field type="uint16_t" name="command">ID of the command to be responsed.</field>
        <field type="uint8_t" name="result" enum="MAV_RESULT">Result of the command execution.</field>
        <field type="uint8_t" name="progress">Percentage of the execution of commands taking noticable time.</field>
        <field type="uint8_t" name="target_system">ID of the system to send message</field>
        <field type="uint8_t" name="target_component">ID of the component to send message</field>
        <field type="uint16_t" name="request_number">A number to assign the command and its response to eachother</field>
      </message>
      <message id="189" name="VIRTUAL_TARGET_GLOBAL_POSITION_INT">
        <description>The global position of the virtual target in funnywing simpleTracker.</description>
        <field type="uint32_t" name="time_boot_ms" units="ms">Timestamp (time since system boot). The rationale for the timestamp in the setpoint is to allow the system to compensate for the transport delay of the setpoint. This allows the system to compensate processing latency.</field>
        <field type="uint8_t" name="coordinate_frame" enum="MAV_FRAME">Valid options are: MAV_FRAME_GLOBAL_INT = 5, MAV_FRAME_GLOBAL_RELATIVE_ALT_INT = 6, MAV_FRAME_GLOBAL_TERRAIN_ALT_INT = 11</field>
        <field type="uint16_t" name="type_mask" enum="POSITION_TARGET_TYPEMASK" display="bitmask">Bitmap to indicate which dimensions should be ignored by the vehicle.</field>
        <field type="int32_t" name="lat_int" units="degE7">X Position in WGS84 frame</field>
        <field type="int32_t" name="lon_int" units="degE7">Y Position in WGS84 frame</field>
        <field type="float" name="alt" units="m">Altitude (MSL, AGL or relative to home altitude, depending on frame)</field>
        <field type="float" name="vx" units="m/s">X velocity in NED frame</field>
        <field type="float" name="vy" units="m/s">Y velocity in NED frame</field>
        <field type="float" name="vz" units="m/s">Z velocity in NED frame</field>
      </message>
      <message id="190" name="RESCUE_STATUS">
        <description>A message for sending information to GCS about whether the rescue system is active or not.</description>
        <field type="uint8_t" name="rescue_state" enum="RESCUE_STATE">This field is used in monitoring to find that whether the rescue code is enabled or disabled.</field>
      </message>
      <message id="196" name="RESCUE_SET_STATE">
        <description>Sets the states of the rescue code, dis/enabled. not defined in commands, since it the job defined in the RfConnection library of funnywing sends commands automatically to the autopilot and changing that code makes it complex. So defined in messages.</description>
        <field type="uint8_t" name="rescue_state" enum="RESCUE_STATE">The state must be set in the RPI side.</field>
      </message>
      <message id="197" name="FUNNYWING_CUSTOM_COMMAND">
        <description>A message for sending funnywing custom commands, specially from GUI to the RPI side. This is for turning around the limiting of mavlink1 message ids and the fact that COMMAND_LONG/INT's jobs are preventing from using custom commands(actually commands are automatically sent to the autopilot and so we can't use them.).</description>
        <field type="uint8_t" name="target_system">System which should execute the command</field>
        <field type="uint8_t" name="target_component">Component which should execute the command, 0 for all components</field>
        <field type="uint16_t" name="command" enum="FUNNYWING_CUSTOM_CMD">Command ID (of custom command to send).</field>
        <field type="int32_t[5]" name="int_params">List of integer parameters of the command.</field>
        <field type="uint8_t[5]" name="bool_params">List of boolean parameters of the command.</field>
        <field type="float[5]" name="float_params">List of float parameters of the command.</field>
      </message>
      <message id="198" name="SET_CAM_BASED_GUIDANCE_CONFIGS">
        <description>This message is used for changing the camera based guidance parameters and configurations by GUI at run-time. Note that these configurations must be tuned in the reference zoom level of the camera or the errors feeding into them must be determined in the reference zoom level or converted into the corresponding errors in the reference zoom level.</description>
        <field type="uint8_t" name="profile_type" enum="THROTTLE_PROFILE_TYPE">Defines the type of throttle profile used at the camera based guidance.</field>
        <field type="float" name="const_throttle">Defines the constant value used in the constant throttle profile, range: [0, 1].</field>
        <field type="float[3]" name="x_pids">PID constants of the camera based guidance in the x axis of the image.</field>
        <field type="float[3]" name="y_pids">PID constants of the camera based guidance in the y axis of the image.</field>
        <field type="float" name="a">Constant 'a' in the sigmoid profile.</field>
        <field type="float" name="b">Constant 'b' in the sigmoid profile.</field>
        <field type="float" name="wing_too_below_throttle">Constant [0, 1] value for throttle when we are in the near vicinity and too below of the funnypoint.</field>
        <field type="float" name="wing_too_above_throttle">Constant [0, 1] value for throttle when we are in the near vicinity and too above of the funnypoint.</field>
        <field type="float" name="wing_tg_at_same_level_throttle">Constant [0, 1] value for throttle when we are in the near vicinity and approximately at the same level with the funnypoint.</field>
        <field type="uint16_t" name="size_threshold">A threshold in sigmoid profile for measuring how far we are from the funnypoint based on its size in the image.</field>
        <field type="uint16_t" name="wing_too_below_threshold">A threshold in the number of pixels from reference image point(normally image center) specifying that we are too below of the funnypoint or not in the case, we are in the near vicinity of the funnypoint.</field>
        <field type="uint16_t" name="wing_too_above_threshold">A threshold in the number of pixels from reference image point(normally image center) specifying that we are too above of the funnypoint or not in the case, we are in the near vicinity of the funnypoint.</field>
      </message>
      <message id="199" name="TRACK_STATUS">
        <description>This message is used for sending the visual tracks detected and tracked on the onboard computer to GCS for monitoring.</description>
        <field type="uint32_t" name="time_stamp" units="ms">Time stamp for later synchronization of the tracks and displaying frames.</field>
        <field type="uint16_t" name="track_id">Id of the track.</field>
        <field type="uint32_t" name="frame_count">A counter for collecting the tracks belonging to the same frame. actually some sort of synchronization without the time stamp.</field>
        <field type="uint8_t" name="track_state" enum="TRACK_STATE">A flag to demonstrate the state of the track. At the moment used just for lock and unlock states.</field>
        <field type="float" name="top_left_x">normalized, [0, 1], top left x cooridinate of the bounding box.</field>
        <field type="float" name="top_left_y">normalized, [0, 1], top left y cooridinate of the bounding box.</field>
        <field type="float" name="bottom_right_x">normalized, [0, 1], bottom right x cooridinate of the bounding box.</field>
        <field type="float" name="bottom_right_y">normalized, [0, 1], bottom right y cooridinate of the bounding box.</field>
      </message>
    </messages>

</mavlink>



